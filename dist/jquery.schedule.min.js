!function(t,e,i,r){"use strict";function o(e,i){this.element=e,this.settings=t.extend({},n,i),this._defaults=n,this._name=s,this.init()}var s="jqs",n={mode:"read",display:"full",data:[],hour:"24",days:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],invalidPeriod:"Invalid period",removePeriod:"Remove this period ?"};t.extend(o.prototype,{init:function(){var e=this;t(this.element).addClass("jqs"),"edit"===this.settings.mode&&t(this.element).on("click",".jqs-wrapper",function(i){if(t(i.target).hasClass("jqs-select")||t(i.target).parents(".jqs-select").length>0)return!1;var r=Math.round(i.offsetY/20);r>=48&&(r=47),e.add(t(this),"id_"+i.timeStamp,r)}).on("click",".jqs-remove",function(){confirm(e.settings.removePeriod)&&t(this).parents(".jqs-select").remove()}),this.create(),this.generate()},create:function(){t('<table class="jqs-table"><tr></tr></table>').appendTo(t(this.element));for(var e=0;e<7;e++)t('<td><div class="jqs-wrapper"></div></td>').appendTo(t(".jqs-table tr",this.element));t('<div class="jqs-grid"><div class="jqs-grid-head"></div></div>').appendTo(t(this.element));for(var i=0;i<25;i++)t('<div class="jqs-grid-line"><span>'+this.formatHour(i)+"</span></div>").appendTo(t(".jqs-grid",this.element));for(var r=0;r<7;r++)t('<div class="jqs-grid-day">'+this.settings.days[r]+"</div>").appendTo(t(".jqs-grid-head",this.element))},generate:function(){if(this.settings.data.length>0){var e=this;t.each(this.settings.data,function(i,r){t.each(r.periods,function(i,o){var s=t(".jqs-wrapper",e.element).eq(r.day),n=e.positionFormat(o[0]),a=e.positionFormat(o[1]);if(0===a&&(a=48),n<=a){var d="id_"+i+r.day+n+a;e.add(s,d,n,a-n)}else console.error(e.settings.invalidPeriod,e.periodInit(n,n+(a-n)))})})}},add:function(e,i,r,o){o||(o=1);var s="";"edit"===this.settings.mode&&(s='<div class="jqs-remove"></div>');var n=this.periodInit(r,r+o),a=t('<div class="jqs-select"><div class="jqs-select-placeholder">'+s+"<span>"+n+"</span></div></div>").css("top",20*r).css("height",20*o).attr("id",i).appendTo(e);if(!this.isValid(a))return console.error(this.settings.invalidPeriod,n),t(a).remove(),!1;if("edit"===this.settings.mode){var d=this;a.draggable({grid:[0,20],containment:"parent",drag:function(e,i){t("span",i.helper).text(d.periodDrag(i))},stop:function(e,i){d.isValid(t(i.helper))||(console.error("Invalid Position"),t(i.helper).css("top",Math.round(i.originalPosition.top)))}}).resizable({grid:[0,20],containment:"parent",handles:"n, s",resize:function(e,i){t("span",i.helper).text(d.periodResize(i))},stop:function(e,i){d.isValid(t(i.helper))||(console.error("Invalid Position"),t(i.helper).css("height",Math.round(i.originalSize.height)))}})}},periodInit:function(t,e){return this.periodFormat(t)+" - "+this.periodFormat(e)},periodDrag:function(e){var i=Math.round(e.position.top/20),r=Math.round((t(e.helper).height()+e.position.top)/20);return this.periodFormat(i)+" - "+this.periodFormat(r)},periodResize:function(t){var e=Math.round(t.position.top/20),i=Math.round((t.size.height+t.position.top)/20);return this.periodFormat(e)+" - "+this.periodFormat(i)},periodFormat:function(t){t>=48&&(t=0);var e=Math.floor(t/2);return e<10&&(e="0"+e),e+=t%2==0?":00":":30"},positionFormat:function(t){var e=t.split(":"),i=2*parseInt(e[0]);return 30===parseInt(e[1])&&i++,i},formatHour:function(t){return t>=24&&(t=0),t<10&&(t="0"+t),t+=":00"},isValid:function(e){var i=Math.round(e.position().top),r=Math.round(e.position().top+e.height()),o=0,s=0,n=!0;return t(".jqs-select",t(e).parent()).each(function(a,d){d=t(d),e.attr("id")!==d.attr("id")&&(o=Math.round(d.position().top),s=Math.round(d.position().top+d.height()),console.log(i,r,o,s),o>i&&o<r&&(console.error("error 1"),n=!1),s>i&&s<r&&(console.error("error 2"),n=!1),o<i&&s>r&&(console.error("error 3"),n=!1),o===i&&s===r&&(console.error("error 4"),n=!1))}),n}}),t.fn[s]=function(e){return this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new o(this,e))})}}(jQuery,window,document);