!function(i,t,e,o){"use strict";function r(t,e){this.element=t,this.settings=i.extend({},s,e),this._defaults=s,this._name=n,this.init()}var n="jqs",s={mode:"read",data:[],days:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],invalidPeriod:"Invalid period.",invalidPosition:"Invalid position.",removePeriod:"Remove this period ?"};i.extend(r.prototype,{init:function(){var t=this;i(this.element).addClass("jqs"),"edit"===this.settings.mode&&i(this.element).on("click",".jqs-wrapper",function(e){if(i(e.target).hasClass("jqs-period")||i(e.target).parents(".jqs-period").length>0)return!1;var o=Math.round(e.offsetY/20);o>=48&&(o=47),t.add(i(this),"id_"+e.timeStamp,o)}).on("click",".jqs-remove",function(){confirm(t.settings.removePeriod)&&i(this).parents(".jqs-period").remove()}),this.create(),this.generate()},create:function(){i('<table class="jqs-table"><tr></tr></table>').appendTo(i(this.element));for(var t=0;t<7;t++)i('<td><div class="jqs-wrapper"></div></td>').appendTo(i(".jqs-table tr",this.element));i('<div class="jqs-grid"><div class="jqs-grid-head"></div></div>').appendTo(i(this.element));for(var e=0;e<25;e++)i('<div class="jqs-grid-line"><span>'+this.formatHour(e)+"</span></div>").appendTo(i(".jqs-grid",this.element));for(var o=0;o<7;o++)i('<div class="jqs-grid-day">'+this.settings.days[o]+"</div>").appendTo(i(".jqs-grid-head",this.element))},generate:function(){if(this.settings.data.length>0){var t=this;i.each(this.settings.data,function(e,o){i.each(o.periods,function(e,r){var n=i(".jqs-wrapper",t.element).eq(o.day),s=t.positionFormat(r[0]),a=t.positionFormat(r[1]);if(0===a&&(a=48),s<=a){var d="id_"+e+o.day+s+a;t.add(n,d,s,a-s)}else console.error(t.settings.invalidPeriod,t.periodInit(s,s+(a-s)))})})}},add:function(t,e,o,r){r||(r=1);var n="";"edit"===this.settings.mode&&(n='<div class="jqs-remove"></div>');var s=this.periodInit(o,o+r),a=i('<div class="jqs-period"><div class="jqs-period-placeholder">'+n+"<span>"+s+"</span></div></div>").css("top",20*o).css("height",20*r).attr("id",e).appendTo(t);if(!this.isValid(a))return console.error(this.settings.invalidPeriod,s),i(a).remove(),!1;if("edit"===this.settings.mode){var d=this;a.draggable({grid:[0,20],containment:"parent",drag:function(t,e){i("span",e.helper).text(d.periodDrag(e))},stop:function(t,e){d.isValid(i(e.helper))||(console.error(d.settings.invalidPosition),i(e.helper).css("top",Math.round(e.originalPosition.top)))}}).resizable({grid:[0,20],containment:"parent",handles:"n, s",resize:function(t,e){i("span",e.helper).text(d.periodResize(e))},stop:function(t,e){d.isValid(i(e.helper))||(console.error(d.settings.invalidPosition),i(e.helper).css("height",Math.round(e.originalSize.height)))}})}},periodInit:function(i,t){return this.periodFormat(i)+" - "+this.periodFormat(t)},periodDrag:function(t){var e=Math.round(t.position.top/20),o=Math.round((i(t.helper).height()+t.position.top)/20);return this.periodFormat(e)+" - "+this.periodFormat(o)},periodResize:function(i){var t=Math.round(i.position.top/20),e=Math.round((i.size.height+i.position.top)/20);return this.periodFormat(t)+" - "+this.periodFormat(e)},periodData:function(i){var t=Math.round(i.position().top/20),e=Math.round((i.height()+i.position().top)/20);return[this.periodFormat(t),this.periodFormat(e)]},periodFormat:function(i){i>=48&&(i=0);var t=Math.floor(i/2);return t<10&&(t="0"+t),t+=i%2==0?":00":":30"},positionFormat:function(i){var t=i.split(":"),e=2*parseInt(t[0]);return 30===parseInt(t[1])&&e++,e},formatHour:function(i){return i>=24&&(i=0),i<10&&(i="0"+i),i+=":00"},isValid:function(t){var e=Math.round(t.position().top),o=Math.round(t.position().top+t.height()),r=0,n=0,s=!0;return i(".jqs-period",i(t).parent()).each(function(a,d){d=i(d),t.attr("id")!==d.attr("id")&&(r=Math.round(d.position().top),n=Math.round(d.position().top+d.height()),r>e&&r<o&&(s=!1),n>e&&n<o&&(s=!1),r<e&&n>o&&(s=!1),r===e&&n===o&&(s=!1))}),s},export:function(){var t=this,e=[];return i(".jqs-wrapper",t.element).each(function(o,r){var n={day:o,periods:[]};i(".jqs-period",r).each(function(e,o){n.periods.push(t.periodData(i(o)))}),e.push(n)}),JSON.stringify(e)}}),i.fn[n]=function(t){var e=!1,o=this.each(function(){i.data(this,"plugin_"+n)?i.isFunction(r.prototype[t])&&(e=i.data(this,"plugin_"+n)[t]()):i.data(this,"plugin_"+n,new r(this,t))});return e||o}}(jQuery,window,document);