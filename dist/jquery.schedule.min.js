!function(t,i,e,r){"use strict";function o(i,e){this.element=i,this.settings=t.extend({},s,e),this._defaults=s,this._name=n,this.init()}var n="jqs",s={mode:"read",data:[],hour:"24",days:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],invalidPeriod:"Invalid period",removePeriod:"Remove this period ?"};t.extend(o.prototype,{init:function(){var i=this;t(this.element).addClass("jqs"),"edit"===this.settings.mode&&t(this.element).on("click",".jqs-wrapper",function(e){if(t(e.target).hasClass("jqs-period")||t(e.target).parents(".jqs-period").length>0)return!1;var r=Math.round(e.offsetY/20);r>=48&&(r=47),i.add(t(this),"id_"+e.timeStamp,r)}).on("click",".jqs-remove",function(){confirm(i.settings.removePeriod)&&t(this).parents(".jqs-period").remove()}),this.create(),this.generate()},create:function(){t('<table class="jqs-table"><tr></tr></table>').appendTo(t(this.element));for(var i=0;i<7;i++)t('<td><div class="jqs-wrapper"></div></td>').appendTo(t(".jqs-table tr",this.element));t('<div class="jqs-grid"><div class="jqs-grid-head"></div></div>').appendTo(t(this.element));for(var e=0;e<25;e++)t('<div class="jqs-grid-line"><span>'+this.formatHour(e)+"</span></div>").appendTo(t(".jqs-grid",this.element));for(var r=0;r<7;r++)t('<div class="jqs-grid-day">'+this.settings.days[r]+"</div>").appendTo(t(".jqs-grid-head",this.element))},generate:function(){if(this.settings.data.length>0){var i=this;t.each(this.settings.data,function(e,r){t.each(r.periods,function(e,o){var n=t(".jqs-wrapper",i.element).eq(r.day),s=i.positionFormat(o[0]),a=i.positionFormat(o[1]);if(0===a&&(a=48),s<=a){var d="id_"+e+r.day+s+a;i.add(n,d,s,a-s)}else console.error(i.settings.invalidPeriod,i.periodInit(s,s+(a-s)))})})}},add:function(i,e,r,o){o||(o=1);var n="";"edit"===this.settings.mode&&(n='<div class="jqs-remove"></div>');var s=this.periodInit(r,r+o),a=t('<div class="jqs-period"><div class="jqs-period-placeholder">'+n+"<span>"+s+"</span></div></div>").css("top",20*r).css("height",20*o).attr("id",e).appendTo(i);if(!this.isValid(a))return console.error(this.settings.invalidPeriod,s),t(a).remove(),!1;if("edit"===this.settings.mode){var d=this;a.draggable({grid:[0,20],containment:"parent",drag:function(i,e){t("span",e.helper).text(d.periodDrag(e))},stop:function(i,e){d.isValid(t(e.helper))||(console.error("Invalid Position"),t(e.helper).css("top",Math.round(e.originalPosition.top)))}}).resizable({grid:[0,20],containment:"parent",handles:"n, s",resize:function(i,e){t("span",e.helper).text(d.periodResize(e))},stop:function(i,e){d.isValid(t(e.helper))||(console.error("Invalid Position"),t(e.helper).css("height",Math.round(e.originalSize.height)))}})}},periodInit:function(t,i){return this.periodFormat(t)+" - "+this.periodFormat(i)},periodDrag:function(i){var e=Math.round(i.position.top/20),r=Math.round((t(i.helper).height()+i.position.top)/20);return this.periodFormat(e)+" - "+this.periodFormat(r)},periodResize:function(t){var i=Math.round(t.position.top/20),e=Math.round((t.size.height+t.position.top)/20);return this.periodFormat(i)+" - "+this.periodFormat(e)},periodData:function(t){var i=Math.round(t.position().top/20),e=Math.round((t.height()+t.position().top)/20);return[this.periodFormat(i),this.periodFormat(e)]},periodFormat:function(t){t>=48&&(t=0);var i=Math.floor(t/2);return i<10&&(i="0"+i),i+=t%2==0?":00":":30"},positionFormat:function(t){var i=t.split(":"),e=2*parseInt(i[0]);return 30===parseInt(i[1])&&e++,e},formatHour:function(t){return t>=24&&(t=0),t<10&&(t="0"+t),t+=":00"},isValid:function(i){var e=Math.round(i.position().top),r=Math.round(i.position().top+i.height()),o=0,n=0,s=!0;return t(".jqs-period",t(i).parent()).each(function(a,d){d=t(d),i.attr("id")!==d.attr("id")&&(o=Math.round(d.position().top),n=Math.round(d.position().top+d.height()),o>e&&o<r&&(s=!1),n>e&&n<r&&(s=!1),o<e&&n>r&&(s=!1),o===e&&n===r&&(s=!1))}),s},export:function(){var i=this,e=[];return t(".jqs-wrapper",i.element).each(function(r,o){var n={day:r,periods:[]};t(".jqs-period",o).each(function(e,r){n.periods.push(i.periodData(t(r)))}),e.push(n)}),JSON.stringify(e)}}),t.fn[n]=function(i){var e=!1,r=this.each(function(){t.data(this,"plugin_"+n)?t.isFunction(o.prototype[i])&&(e=t.data(this,"plugin_"+n)[i]()):t.data(this,"plugin_"+n,new o(this,i))});return e||r}}(jQuery,window,document);